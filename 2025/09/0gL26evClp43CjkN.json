{
  "active": false,
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "RecommendActions",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "OutputFixer1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "RecommendActions": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Trigger": {
      "main": [
        [
          {
            "node": "Memory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If3": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Deal and Invoice Manager.": {
      "ai_tool": [
        [
          {
            "node": "RecommendActions",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "OutputFixer1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "ChatHistory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ChatHistory": {
      "main": [
        [
          {
            "node": "Postgres2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Memory": {
      "main": [
        [
          {
            "node": "FormatHistory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FormatHistory": {
      "main": [
        [
          {
            "node": "RecommendActions",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres2": {
      "main": [
        [
          {
            "node": "If3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OutputFixer1": {
      "ai_outputParser": [
        [
          {
            "node": "RecommendActions",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-09-15T04:44:54.142Z",
  "id": "0gL26evClp43CjkN",
  "meta": null,
  "name": "Recommend-V1.0.3",
  "nodes": [
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {
          "responseFormat": "json_object",
          "temperature": 0.5
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -2932,
        820
      ],
      "id": "5fa0519e-ff36-4127-9abb-2843a808dd37",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "mxdHDElSd4VQZiDt",
          "name": "OpenAi account 2"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{\n  (() => {\n    const lastEmail = $('Trigger').first().json.data.last_email;\n\n    // Extract all email-like strings from the object\n    const emails = JSON.stringify(lastEmail).match(\n      /[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}/g\n    ) || [];\n\n    // If more than one unique email found, return empty string\n    return [...new Set(emails)].length > 3 ? \"\" : lastEmail;\n  })()\n}}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=You are a Patchbay AI assistant that helps music managers handle **deals, agreements, invoices, and split-sheets** through email collaboration.\nYour job: analyze the conversation and **recommend the next best actions**, presented in a **well-structured Gmail-ready HTML body**.\n\n---\n\n## INPUT\n\nBelow data is provided to you:\n\n* User Message: The latest email from the user/Manager.\n* Email Discussion: Earlier discussion through email thread given as below:\n  {{ JSON.stringify( $('Trigger').first().json.data.thread.Emails .sort((a, b) => new Date(b.date) - new Date(a.date)) .map(email => Object.fromEntries( Object.entries(email).filter(([key]) => ![\"EmailId\",\"MessageId\",\"References\",\"cc\",\"date\",\"ThreadId\"].includes(key)) )), null, \" \" ) }}\n* Deal Document (optional): {{ $('Trigger').first().json.data.thread.last_attachment?.document?.slice(0,) || 'Missing' }}\n* Manager: {{ JSON.stringify( $('Trigger').first().json.data.Manager, null, ' ' ) }}\n* Conversation History: {{ $json.history }}\n\n---\n\n## ROLE-AWARE NAMING\n\nWhen referring to a person/client/customer, always mention their role when available.\n\n* If role_label and person_name → “{role_label} {person_name}, i.e Producer Alex Goldblatt”\n* If only person_name → “{person_name}”\n* If only role_label → “the {role_label}”\n* Else → “the client”\n* If project_name available → append “for the {project_label || 'project'} ‘{project_name}’”\n\nExamples:\n\n* “Producer Allan for the master ‘Ocean Drive’”\n* “Artist Manager Carla for the project ‘Neon Skies’”\n* “the client” (if nothing else is available)\n\n---\n\n## CORE PRINCIPLES\n\n* Intent-First\n\n  * Always prioritize the manager’s latest message\n  * Tool output is supportive, not dominant\n\n* Greeting Heuristic:\n- greet = {{ $json.history === \"Missing\" ? \"true\" : \"false\" }}\n\n* Verbosity Policy\n\n  * Minimal → direct asks\n  * Standard → updates/creation\n  * Detailed → if explicitly requested or ambiguous\n\n* Memory-Aware Behavior\n\n  * Use prior context only from this thread\n  * If conflict, latest manager ask wins\n\n* Safety & Constraints\n\n  * Never leak IDs and numbers, logs, or system terms. specifically, deal_number, invoice_nummber, person_number, user_id etc.\n  * Invoice recipient never in update flows\n  * Always include Invoice ID(invoice_id provided as numerical number) when asking for confirmation or refering to an existing invoice.\n  * Always include Deal ID(deal_id provided as numerical number) when asking for confirmation or refering to an existing deal.\n  * Tone: Polite, concise, manager-oriented\n  * Personalization: Always address manager by first name\n\n---\n\n## TOOL\n\nDealAndInvoiceManager — returns metadata for customer confirmation, deal status, and invoice status.\n\n---\n\n## EXECUTION LOGIC\n\n### Step 1 — Analyze\n\nParse tool output: customer_confirmation, deal_status, invoice_status, propose_to_manager_on_deal, propose_to_manager_on_invoice, and any role/project tokens.\n- You will analyse and compare if the the tool is directing you to compred with the Email Conversation and deal document. You should draft what ever needs to be updated/created for manager review and ask his approval.\n\n### Step 2 — Generate Response\n\n* Customer Confirmation\n\n  * duplicate → “I noticed multiple entries for {display_name_with_role_and_project}…” then ask manager to confirm\n  * not_found → “I wasn’t able to find {display_name_with_role_and_project} in your workspace…” then ask manager if registered\n  * verified → continue normal flow\n\n* Deal and Invoice Scenarios\n\n  * deal=update & invoice=update → brief summary, Deal + Invoice sections, ask for approval\n  * deal=update & invoice=create_new → summary, show deal updates + new invoice, ask for approval\n  * deal=create & invoice=create_new → new deal + new invoice, include recipient\n  * deal=no_action & invoice=create_new → only invoice terms\n  * deal=no_action & invoice=update → invoice updates only, no recipient mention\n  * deal=no_action & invoice=no_action → “I couldn’t identify a deal or invoice task.” ask for clarification\n  * invoice=await_confirmation → show invoices in table with Invoice IDs, ask manager to select\n  * deal=missing_information → state missing info, ask manager to provide\n  * deal=Unrecognised → inform no master deal recognized, ask for clarification\n\n---\n\n## OUTPUT FORMAT (HTML)\n\n<div style=\"font-family:Arial,Helvetica,sans-serif;font-size:14px;line-height:1.5;color:#111;max-width:680px;\">\n\n  {#if greet = \"false\"}\n    <p></p>\n  {/if}\n\n  {#if greet = \"true\"}\n    <p>Hello <Manager first name></p>\n  {/if}\n\n  <p>{summary}</p>\n\n  {#if deal_terms}\n    <p><b>Deal</b></p>\n    <ul>{#each deal_terms}<li>{this}</li>{/each}</ul>\n  {/if}\n\n  {#if invoice_terms}\n    <p><b>Invoice</b></p>\n    <ul>{#each invoice_terms}<li>{this}</li>{/each}</ul>\n  {/if}\n\n  {#if customer_confirmation == 'duplicate'}\n    <p>I found multiple entries for {display_name_with_role_and_project}:</p>\n    <ul>{#each duplicates}<li>{this}</li>{/each}</ul>\n    <p>Could you confirm which {display_name_with_role_only} you'd like me to proceed with?</p>\n  {/if}\n\n  {#if customer_confirmation == 'not_found'}\n    <p>I wasn't able to find {display_name_with_role_and_project} in your workspace, so I can't move forward with creating a deal or invoice just yet. Could you confirm if this {customer_role} is registered, or let me know if I've misunderstood?</p>\n  {/if}\n\n  {#if missing_info}\n    <p><b>Missing Information</b></p>\n    <ul>{#each missing_info}<li>{this}</li>{/each}</ul>\n    <p>Could you provide these details so I can continue?</p>\n  {/if}\n\n  {#if deal_terms && invoice_terms}\n    <p>If you want to proceed with the above deal and invoice changes, please reply with &quot;Approved&quot;.</p>\n  {/if}\n\n  {#if deal_status == 'create'}\n    <p>If you want to create a new deal, please reply with &quot;Create Deal&quot;.</p>\n  {/if}\n\n  {#if invoice_status == 'await_confirmation'}\n    <p>Please select one of the invoices listed above by replying with its Invoice ID.</p>\n  {/if}\n\n  {#if invoice_status == 'create_new' && invoice_recipient_missing}\n    <p>To create an invoice with the proposed terms, please let me know. Also, the provided invoice recipient is not in the client's workspace &mdash; should I register it as a new recipient?</p>\n  {/if}\n\n  <hr>\n  <p>Best,<br>Patchbay Assistant</p>\n</div>\n```",
          "maxIterations": 10,
          "returnIntermediateSteps": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -2960,
        400
      ],
      "id": "5a258a6b-f90b-4c6b-8ed3-2c2114512ea0",
      "name": "RecommendActions",
      "retryOnFail": false
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "data",
              "type": "any"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -3620,
        400
      ],
      "id": "e8d1df8b-390e-45b4-9261-e882585b9a82",
      "name": "Trigger"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "46e7750e-0c4f-4a33-9f60-32a5ade9a825",
              "name": "output.response",
              "value": "={{ $('RecommendActions').first().json.output.response_html }}",
              "type": "string"
            },
            {
              "id": "bb45c3d6-d9f9-42be-bf44-db9a445fffde",
              "name": "output.tool_executed",
              "value": "={{ $('RecommendActions').first().json.output.tool_executed }}",
              "type": "boolean"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1496,
        300
      ],
      "id": "84517a13-b3a3-4dcb-bd51-a0540a02f62e",
      "name": "Edit Fields3",
      "executeOnce": true
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "ea8bc648-c48d-417d-86f0-5cef6db4a27c",
              "leftValue": "={{ $('RecommendActions').first().json.output.isNotEmpty() }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -1716,
        400
      ],
      "id": "7ed05cd4-c7ab-47f5-a142-daf218d077b6",
      "name": "If3"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a162561e-1399-4ee3-9db1-452ef7e923b3",
              "name": "message",
              "value": false,
              "type": "boolean"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1496,
        500
      ],
      "id": "fea64cc1-3498-4d2b-acdf-92d952bedae8",
      "name": "Edit Fields4",
      "alwaysOutputData": false,
      "executeOnce": true
    },
    {
      "parameters": {
        "name": "DealAndInvoiceManager",
        "description": "Call this tool to;\n- Identify the client in manager workspace\n- Locate previous deals and invoices related to a client/customer.\n- Locate invoice clients for a customer.\n",
        "workflowId": {
          "__rl": true,
          "value": "kuGXeaPacLgBd29m",
          "mode": "list",
          "cachedResultName": "DealAndInvoice-V1.0.3"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "action": "deals_and_invoices",
            "data": "={{ { \n\"user_id\": $fromAI('user_id', `User_id of the manager associated`, 'string'),\nsession_data: $('Trigger').first().json.data.thread, last_email: $('Trigger').first().json.data.last_email,\nManager: $('Trigger').first().json.data.Manager,\nhistory: $json.history\n} }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "action",
              "displayName": "action",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            },
            {
              "id": "data",
              "displayName": "data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true
            },
            {
              "id": "ai_input",
              "displayName": "ai_input",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string"
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.1,
      "position": [
        -2872,
        620
      ],
      "id": "d63c8856-f819-4b82-bcbb-4e46d9811177",
      "name": "Deal and Invoice Manager."
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n\t\"type\": \"object\",\n\t\"properties\": {\n\t\t\"response_html\": {\n\t\t\t\"type\": \"string\",\n\t\t\t\"description\": \"Gmail-ready HTML response to be sent to the manager.\"\n\t\t},\n\t\t\"tool_executed\": {\n\t\t\t\"type\": \"boolean\",\n\t\t\t\"description\": \"True if the DealAndInvoiceManager tool was executed, false otherwise.\"\n\t\t},\n        \"modification_requested\": {\n          \"type\": \"boolean\",\n          \"description\": \"Set true only when the user have proposed some changes to the previous recommendations by you and you only. Otherwise, call the tool: DealAndInvoiceManager.\"\n        }\n\t}\n}\n"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        -2644,
        820
      ],
      "id": "ce77694f-ea9e-4405-a79f-5a09a879c6ef",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "jsCode": "// n8n Code node (JavaScript)\n// Creates two DB-ready objects (human, then ai) with cleaned content\n// Adds \"Last interaction: <date time>\" to the human message content\n// Hardened for Postgres: escapes backslashes and invalid \\u escapes, removes null bytes, fixes unpaired surrogates.\n\n// ---------------- Helpers ----------------\nconst toStr = (v) => (v === null || v === undefined) ? \"\" : String(v);\n\n/** Strip HTML to plain text and tidy whitespace */\nfunction stripHtml(html) {\n  const s = toStr(html);\n  const withoutTags = s.replace(/<[^>]*>/g, \" \");\n  const decoded = withoutTags\n    .replace(/&nbsp;/gi, \" \")\n    .replace(/&amp;/gi, \"&\")\n    .replace(/&lt;/gi, \"<\")\n    .replace(/&gt;/gi, \">\")\n    .replace(/&#39;/gi, \"'\")\n    .replace(/&quot;/gi, '\"');\n  return decoded.replace(/\\s+/g, \" \").trim();\n}\n\n/** Try to parse JSON safely */\nfunction tryParseJson(s) {\n  if (typeof s !== \"string\") return null;\n  const trimmed = s.trim();\n  if (!(trimmed.startsWith(\"{\") || trimmed.startsWith(\"[\"))) return null;\n  try { return JSON.parse(trimmed); } catch { return null; }\n}\n\n/** Remove null bytes and fix unpaired surrogate code units */\nfunction sanitizeUnicode(s) {\n  let out = s.replace(/\\u0000/g, \"\"); // remove NULs\n  // remove unpaired surrogates\n  out = out.replace(/[\\uD800-\\uDBFF](?![\\uDC00-\\uDFFF])|(?<![\\uD800-\\uDBFF])[\\uDC00-\\uDFFF]/g, \"�\");\n  return out;\n}\n\n/** Escape content so Postgres won't treat \\u... as a Unicode escape */\nfunction escapeForPostgresText(s) {\n  // First, double all backslashes\n  let out = s.replace(/\\\\/g, \"\\\\\\\\\");\n  // If any sequence looks like \\u but not \\uXXXX, re-escape it (turn \\\\u into \\\\\\\\u in the final string)\n  out = out.replace(/\\\\u(?![0-9a-fA-F]{4})/g, \"\\\\\\\\u\");\n  return out;\n}\n\n/** Normalize AI/Human content */\nfunction normalizeContent(raw) {\n  const asString = typeof raw === \"string\" ? raw : JSON.stringify(raw ?? \"\");\n  const maybeJson = tryParseJson(asString);\n\n  if (maybeJson && typeof maybeJson === \"object\") {\n    const respHtml =\n      maybeJson?.output?.response_html ??\n      maybeJson?.response_html ??\n      maybeJson?.html ??\n      null;\n\n    if (respHtml) return stripHtml(respHtml);\n\n    if (typeof maybeJson.content === \"string\") {\n      const c = maybeJson.content.trim();\n      return /<[^>]+>/.test(c) ? stripHtml(c) : c;\n    }\n    return JSON.stringify(maybeJson);\n  }\n\n  return /<[^>]+>/.test(asString) ? stripHtml(asString) : asString.trim();\n}\n\n/** Build one DB record */\nfunction buildRecord({ tag, content, session_id, id = null }) {\n  const type = (toStr(tag).toLowerCase() === \"human\") ? \"human\" : \"ai\";\n  let cleaned = normalizeContent(content);\n\n  // Add last interaction timestamp only for human\n  if (type === \"human\") {\n    const ts = new Date().toISOString(); // ISO 8601 (UTC)\n    cleaned += `\\n\\nLast interaction: ${ts}`;\n  }\n\n  // Unicode + Postgres safety\n  cleaned = sanitizeUnicode(cleaned);\n  cleaned = escapeForPostgresText(cleaned);\n\n  return {\n    json: {\n      session_id: toStr(session_id),\n      message: {\n        type,\n        content: cleaned,\n        tool_calls: [],\n        additional_kwargs: {},\n        response_metadata: {},\n        invalid_tool_calls: []\n      }\n    }\n  };\n}\n\n// ---------------- Input Normalization ----------------\nconst inJson = $json ?? {};\nlet humanRec = null;\nlet aiRec = null;\n\n// Case 1: records array\nif (Array.isArray(inJson.records)) {\n  for (const r of inJson.records) {\n    const tag = toStr(r?.tag).toLowerCase();\n    if (tag === \"human\") humanRec = { ...r };\n    if (tag === \"ai\") aiRec = { ...r };\n  }\n}\n\n// Case 2: explicit human/ai objects\nif (!humanRec && inJson.human) {\n  humanRec = {\n    tag: \"human\",\n    content: inJson.human.content,\n    session_id: inJson.human.session_id ?? inJson.session_id\n  };\n}\nif (!aiRec && inJson.ai) {\n  aiRec = {\n    tag: \"ai\",\n    content: inJson.ai.content,\n    session_id: inJson.ai.session_id ?? inJson.session_id\n  };\n}\n\n// Case 3: separate fields\nif (!humanRec && (inJson.human_content || inJson.human_text)) {\n  humanRec = {\n    tag: \"human\",\n    content: inJson.human_content ?? inJson.human_text,\n    session_id: inJson.session_id\n  };\n}\nif (!aiRec && (inJson.ai_content || inJson.ai_text)) {\n  aiRec = {\n    tag: \"ai\",\n    content: inJson.ai_content ?? inJson.ai_text,\n    session_id: inJson.session_id\n  };\n}\n\n// Case 4: fallback\nif (!humanRec && !aiRec && inJson.tag && inJson.content) {\n  const tag = toStr(inJson.tag).toLowerCase();\n  if (tag === \"human\") humanRec = { tag: \"human\", content: inJson.content, session_id: inJson.session_id };\n  if (tag === \"ai\") aiRec = { tag: \"ai\", content: inJson.content, session_id: inJson.session_id };\n}\n\n// Session fallback\nconst sessionFallback = humanRec?.session_id ?? aiRec?.session_id ?? inJson.session_id ?? \"\";\nif (humanRec && !humanRec.session_id) humanRec.session_id = sessionFallback;\nif (aiRec && !aiRec.session_id) aiRec.session_id = sessionFallback;\n\n// ---------------- Build Output ----------------\nconst out = [];\nif (humanRec) out.push(buildRecord(humanRec));\nif (aiRec) out.push(buildRecord(aiRec));\n\nif (out.length === 0) {\n  throw new Error(\"No valid inputs found. Provide `records`, or human/ai objects, or content fields.\");\n}\n\nreturn out;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2156,
        400
      ],
      "id": "417f83a7-2ee7-4ac6-a634-02a309bc84b5",
      "name": "ChatHistory"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "={{\n  {\n  records: [\n    { tag: \"human\", content: $('Trigger').first().json.data.last_email, session_id: $('Trigger').first().json.data.thread.ThreadId + $('Trigger').first().json.data.Manager.user_id},\n    { tag: \"ai\", content: $json.output.response_html, session_id: $('Trigger').first().json.data.thread.ThreadId + $('Trigger').first().json.data.Manager.user_id},\n  ]\n  }\n}}",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2376,
        400
      ],
      "id": "024bbe04-5680-4495-a2b9-b5d5aa61d667",
      "name": "Edit Fields5"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "value": "public",
          "mode": "list",
          "cachedResultName": "public"
        },
        "table": {
          "__rl": true,
          "value": "n8n_chat_histories",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "session_id",
              "displayName": "session_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "message",
              "displayName": "message",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -1936,
        400
      ],
      "id": "b0b9a269-72ab-4959-882f-707ccb5d796f",
      "name": "Postgres2",
      "retryOnFail": true,
      "maxTries": 2,
      "credentials": {
        "postgres": {
          "id": "wYLes21z9h3njdSn",
          "name": "postgress-prod"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// n8n Function node\n// Input: last 10 message objects, newest at index 0\n// Output: { json: { markdown: \"<markdown string>\" } }\n\nconst WINDOW_SIZE = 10;\n\n// ---- Helpers ----\nconst toStr = (v) => (v === null || v === undefined) ? \"\" : String(v);\n\nconst stripHtml = (s) => {\n  const str = toStr(s);\n  return str\n    .replace(/<style[\\s\\S]*?<\\/style>/gi, \" \")\n    .replace(/<script[\\s\\S]*?<\\/script>/gi, \" \")\n    .replace(/<[^>]*>/g, \" \")\n    .replace(/\\s+/g, \" \")\n    .trim();\n};\n\nconst decodeHtml = (s) => {\n  const map = {\n    \"&nbsp;\": \" \",\n    \"&lt;\": \"<\",\n    \"&gt;\": \">\",\n    \"&amp;\": \"&\",\n    \"&quot;\": \"\\\"\",\n    \"&#39;\": \"'\",\n  };\n  return toStr(s).replace(/(&nbsp;|&lt;|&gt;|&amp;|&quot;|&#39;)/g, (m) => map[m] || m);\n};\n\nconst htmlToText = (html) => stripHtml(decodeHtml(html));\n\nconst safeJsonParse = (val) => {\n  if (typeof val !== \"string\") return null;\n  const t = val.trim();\n  if (!(t.startsWith(\"{\") || t.startsWith(\"[\"))) return null;\n  try { return JSON.parse(t); } catch { return null; }\n};\n\nconst formatTime = (raw) => {\n  if (!raw) return \"unknown\";\n  // If it's already a readable string (e.g., \"2025-09-05 10:23:44\"), keep it.\n  // Otherwise try to parse and convert to ISO.\n  const d = new Date(raw);\n  if (isNaN(d.getTime())) return toStr(raw).trim();\n  // Use local-like ISO without milliseconds for readability\n  const iso = d.toISOString().replace(\"T\", \" \").replace(\".000Z\", \"Z\");\n  return iso;\n};\n\n// ---- Collect messages (use order as provided; newest first) ----\nlet messages = [];\nif (items.length === 1) {\n  const j = items[0].json ?? {};\n  if (Array.isArray(j)) messages = j;\n  else if (Array.isArray(j.data)) messages = j.data;\n  else if (Array.isArray(j.messages)) messages = j.messages;\n  else if (j.id && j.message) messages = [j];\n} else {\n  for (const it of items) {\n    const j = it.json ?? {};\n    if (j.id && j.message) messages.push(j);\n  }\n}\n\nif (!messages.length) {\n  return [{ json: { history: \"Missing\" } }];\n}\n\n// ---- Keep window of 10 (already newest-first), then switch to chronological for pairing ----\nconst windowMsgs = messages.slice(0, WINDOW_SIZE);\nconst chronological = windowMsgs.slice().reverse(); // oldest -> newest\n\n// ---- Build user→AI turns (with timestamps) ----\nconst turns = [];\nfor (let i = 0; i < chronological.length; i++) {\n  const msg = chronological[i];\n  if (msg?.message?.type === \"human\") {\n    const userRaw = msg.message.content ?? \"\";\n    const userText = stripHtml(userRaw);\n    \n    let aiText = null;\n\n    // Look ahead for next AI reply within the window\n    for (let j = i + 1; j < chronological.length; j++) {\n      const next = chronological[j];\n      const type = next?.message?.type;\n      if (type === \"ai\") {\n        const raw = next.message.content ?? \"\";\n        const parsed = safeJsonParse(raw);\n        const responseHtml = parsed?.output?.response_html ?? null;\n        aiText = responseHtml ? htmlToText(responseHtml) : stripHtml(raw);\n        break;\n      }\n      if (type === \"human\") break; // next human starts a new turn\n    }\n\n    turns.push({\n      userText,\n      aiText,\n    });\n  }\n}\n\n// ---- Build Markdown string ----\nlet md = `### Conversation (last ${Math.min(WINDOW_SIZE, turns.length)} turns)\\n\\n`;\nturns.forEach((t) => {\n  md += `**User** ${t.userText}\\n\\n`;\n  if (t.aiText) {\n    md += `**AI** ${t.aiText}\\n\\n`;\n  } else {\n    md += `**AI** (no reply found)_\\n\\n`;\n  }\n});\n\nreturn [{\n  json: {\n    history: md.trim()\n  }\n}];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -3180,
        400
      ],
      "id": "fe833726-2057-4c66-b436-812b93efb2a9",
      "name": "FormatHistory"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "n8n_chat_histories",
          "mode": "name"
        },
        "limit": 12,
        "where": {
          "values": [
            {
              "column": "session_id",
              "value": "={{ $json.data.thread.ThreadId+$('Trigger').item.json.data.Manager.user_id }}"
            }
          ]
        },
        "sort": {
          "values": [
            {
              "column": "id",
              "direction": "DESC"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        -3400,
        400
      ],
      "id": "58bf27ce-6874-4885-8681-f284bf7aa766",
      "name": "Memory",
      "executeOnce": true,
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "postgres": {
          "id": "wYLes21z9h3njdSn",
          "name": "postgress-prod"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserAutofixing",
      "typeVersion": 1,
      "position": [
        -2752,
        622.5
      ],
      "id": "44edc364-d4b3-45ae-9c1c-0f024d1bb676",
      "name": "OutputFixer1"
    },
    {
      "parameters": {
        "name": "DecideGreet",
        "description": "Call this tool on every message to decide how to greet the user.",
        "jsCode": "// n8n Code node (JavaScript)\n// INPUT ($json):\n// {\n//   \"conversation_history_status\": true|false,\n//   \"last_interaction_time\": \"2025-09-02T07:45:00Z\" | null,\n//   \"manager_first_name\": \"Aidan\" (optional),\n//   \"current_time\": \"2025-09-03T10:15:00Z\" (optional)\n// }\n\nfunction parseDate(v) {\n  if (!v) return null;\n  const d = new Date(v);\n  return isNaN(d.getTime()) ? null : d;\n}\n\nfunction getTimeOfDay(date) {\n  const h = date.getHours();\n  if (h < 12) return \"morning\";\n  if (h < 18) return \"afternoon\";\n  return \"evening\";\n}\n\nconst hasHistory = Boolean($json.conversation_history_status);\nconst lastRaw = $json.last_interaction_time ?? null;\nconst now = parseDate($json.current_time) || new Date();\nconst last = parseDate(lastRaw);\n\nlet should_greet = false;\n\nif (!hasHistory) {\n  should_greet = true;\n} else if (last) {\n  const hoursSinceLast = (now - last) / (1000 * 60 * 60);\n  if (hoursSinceLast > 24) should_greet = true;\n} else {\n  should_greet = false; // history but no timestamp\n}\n\nconst time_of_day = should_greet ? getTimeOfDay(now) : null;\nconst firstName = ($json.manager_first_name || \"\").trim();\n\nlet greeting_instruction = \"\";\n\nif (should_greet) {\n  greeting_instruction = `Begin the email with: \"Good ${time_of_day}${firstName ? ` ${firstName}` : \"\"},\" followed by a line break. Use this only once.`;\n} else {\n  greeting_instruction = \"Do not include any greeting line. Start directly with the task response to avoid repetition.\";\n}\n\n// Return as a plain string\nreturn greeting_instruction;\n",
        "specifyInputSchema": true,
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"title\": \"GreetingAutomationInput\",\n  \"description\": \"Schema for greeting decision logic. The AI must extract these values from the conversation history.\",\n  \"properties\": {\n    \"last_interaction_time\": {\n      \"type\": [\"string\", \"null\"],\n      \"format\": \"date-time\",\n      \"description\": \"The timestamp of the last user → assistant interaction in ISO 8601 format (e.g., 2025-09-02T07:45:00Z). If no prior interaction is found, set this to null.\"\n    },\n    \"conversation_history_status\": {\n      \"type\": \"boolean\",\n      \"description\": \"Boolean flag indicating whether any prior conversation history exists. True = history present, False = no prior history.\"\n    }\n  },\n  \"required\": [\"last_interaction_time\", \"conversation_history_status\"],\n  \"additionalProperties\": false\n}\n"
      },
      "type": "@n8n/n8n-nodes-langchain.toolCode",
      "typeVersion": 1.1,
      "position": [
        -3620,
        860
      ],
      "id": "afb34c3d-b265-473d-9f18-329f94c59e81",
      "name": "GreetingAutomation"
    }
  ],
  "pinData": {
    "Trigger": [
      {
        "json": {
          "data": {
            "thread": {
              "ThreadId": "198f7c2062f45c15",
              "Emails": [
                {
                  "ThreadId": "198f7c2062f45c15",
                  "EmailId": "1997cd28fccc6c07",
                  "MessageId": "<mfy9vawb.3af88f64-e821-42f7-9ef0-385061187d1b@we.are.superhuman.com>",
                  "References": [
                    "<mfe5xwrl.155cb960-6644-47d3-b4fb-d5177301c3d7@we.are.superhuman.com>",
                    "<CAEaeWjRvo2UcNntyXt7V1JH3AqdU+mTaMFNC+T+7xvePTANNXg@mail.gmail.com>"
                  ],
                  "Subject": "Re: Fwd: RE: RE: Hurri Haran Invoice // \"Stingy\"",
                  "From": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "to": [
                    {
                      "address": "asst@patchbay.xyz",
                      "name": ""
                    }
                  ],
                  "cc": [],
                  "date": "2025-09-24T17:43:15.000Z",
                  "emailText": "It's created already I think Best, Aidan Schechter AIDAN SCHECHTER P: +1 310.467.6229 | E: AIDAN@1916MGMT.COM"
                },
                {
                  "ThreadId": "198f7c2062f45c15",
                  "EmailId": "1997cd28fccc6c07",
                  "MessageId": "<mfy9vawb.3af88f64-e821-42f7-9ef0-385061187d1b@we.are.superhuman.com>",
                  "References": [
                    "<mfe5xwrl.155cb960-6644-47d3-b4fb-d5177301c3d7@we.are.superhuman.com>",
                    "<CAEaeWjRvo2UcNntyXt7V1JH3AqdU+mTaMFNC+T+7xvePTANNXg@mail.gmail.com>"
                  ],
                  "Subject": "Re: Fwd: RE: RE: Hurri Haran Invoice // \"Stingy\"",
                  "From": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "to": [
                    {
                      "address": "asst@patchbay.xyz",
                      "name": ""
                    }
                  ],
                  "cc": [],
                  "date": "2025-09-24T17:43:15.000Z",
                  "emailText": "It's created already I think Best, Aidan Schechter AIDAN SCHECHTER P: +1 310.467.6229 | E: AIDAN@1916MGMT.COM"
                },
                {
                  "ThreadId": "198f7c2062f45c15",
                  "EmailId": "199345923349ee49",
                  "MessageId": "<mfe5xwrl.155cb960-6644-47d3-b4fb-d5177301c3d7@we.are.superhuman.com>",
                  "References": [
                    "<mfbysfc2.a973a2de-b6c9-486f-a53c-281bd180b8a4@we.are.superhuman.com>",
                    "<CAEaeWjTX68y2QOQjgRaVsnQ4V5db5CAhZBv645HBiRK2V6zpog@mail.gmail.com>"
                  ],
                  "Subject": "Re: Fwd: RE: RE: Hurri Haran Invoice // \"Stingy\"",
                  "From": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "to": [
                    {
                      "address": "asst@patchbay.xyz",
                      "name": ""
                    }
                  ],
                  "cc": [],
                  "date": "2025-09-10T15:57:58.000Z",
                  "emailText": "Artist Hurri Haran Master \"Stingy\" Best, Aidan Schechter AIDAN SCHECHTER P: +1 310.467.6229 | E: AIDAN@1916MGMT.COM"
                },
                {
                  "ThreadId": "198f7c2062f45c15",
                  "EmailId": "1992c6c76dcff583",
                  "MessageId": "<mfbysfc2.a973a2de-b6c9-486f-a53c-281bd180b8a4@we.are.superhuman.com>",
                  "References": [
                    "<mctwrly9.f2de59ce-e90a-4dec-b9a7-4b2a8e494e80@we.are.superhuman.com>",
                    "<md57649s.e7584ac4-8d88-47eb-9aed-84da5bfa0117@we.are.superhuman.com>",
                    "<AS2PR02MB10388D120F9DA3981A0A70DA98456A@AS2PR02MB10388.eurprd02.prod.outlook.com>",
                    "<mein0009.2a2b9d4a-1da0-478a-b8bd-8c8b263d1241@we.are.superhuman.com>",
                    "<GV4PR02MB113998C2295A8CAB2B8D4343F8430A@GV4PR02MB11399.eurprd02.prod.outlook.com>",
                    "<GV4PR02MB113996185794A1D0742D521478430A@GV4PR02MB11399.eurprd02.prod.outlook.com>"
                  ],
                  "Subject": "Fwd: RE: RE: Hurri Haran Invoice // \"Stingy\"",
                  "From": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "to": [
                    {
                      "address": "asst@patchbay.xyz",
                      "name": ""
                    }
                  ],
                  "cc": [],
                  "date": "2025-09-09T03:02:06.000Z",
                  "emailText": "Do we have a fully executed agreement for this Alex Goldblatt client producer deal? If so please provide the file here. Best, Aidan Schechter AIDAN SCHECHTER P: +1 310.467.6229 | E: AIDAN@1916MGMT.COM"
                },
                {
                  "ThreadId": "198f7c2062f45c15",
                  "EmailId": "1992c6c76dcff583",
                  "MessageId": "<mfbysfc2.a973a2de-b6c9-486f-a53c-281bd180b8a4@we.are.superhuman.com>",
                  "References": [
                    "<mctwrly9.f2de59ce-e90a-4dec-b9a7-4b2a8e494e80@we.are.superhuman.com>",
                    "<md57649s.e7584ac4-8d88-47eb-9aed-84da5bfa0117@we.are.superhuman.com>",
                    "<AS2PR02MB10388D120F9DA3981A0A70DA98456A@AS2PR02MB10388.eurprd02.prod.outlook.com>",
                    "<mein0009.2a2b9d4a-1da0-478a-b8bd-8c8b263d1241@we.are.superhuman.com>",
                    "<GV4PR02MB113998C2295A8CAB2B8D4343F8430A@GV4PR02MB11399.eurprd02.prod.outlook.com>",
                    "<GV4PR02MB113996185794A1D0742D521478430A@GV4PR02MB11399.eurprd02.prod.outlook.com>"
                  ],
                  "Subject": "Fwd: RE: RE: Hurri Haran Invoice // \"Stingy\"",
                  "From": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "to": [
                    {
                      "address": "asst@patchbay.xyz",
                      "name": ""
                    }
                  ],
                  "cc": [],
                  "date": "2025-09-09T03:02:06.000Z",
                  "emailText": "Do we have a fully executed agreement for this Alex Goldblatt client producer deal? If so please provide the file here. Best, Aidan Schechter AIDAN SCHECHTER P: +1 310.467.6229 | E: AIDAN@1916MGMT.COM"
                },
                {
                  "ThreadId": "198f7c2062f45c15",
                  "EmailId": "198f7c2062f45c15",
                  "MessageId": "<mexcq05s.40f00814-f90d-4dbd-a316-e07f8a4850d5@we.are.superhuman.com>",
                  "References": [
                    "<mctwrly9.f2de59ce-e90a-4dec-b9a7-4b2a8e494e80@we.are.superhuman.com>",
                    "<md57649s.e7584ac4-8d88-47eb-9aed-84da5bfa0117@we.are.superhuman.com>",
                    "<AS2PR02MB10388D120F9DA3981A0A70DA98456A@AS2PR02MB10388.eurprd02.prod.outlook.com>",
                    "<mein0009.2a2b9d4a-1da0-478a-b8bd-8c8b263d1241@we.are.superhuman.com>",
                    "<GV4PR02MB113998C2295A8CAB2B8D4343F8430A@GV4PR02MB11399.eurprd02.prod.outlook.com>",
                    "<GV4PR02MB113996185794A1D0742D521478430A@GV4PR02MB11399.eurprd02.prod.outlook.com>"
                  ],
                  "Subject": "Fwd: RE: RE: Hurri Haran Invoice // \"Stingy\"",
                  "From": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "to": [
                    {
                      "address": "asst@patchbay.xyz",
                      "name": ""
                    }
                  ],
                  "cc": [],
                  "date": "2025-08-29T21:35:42.000Z",
                  "emailText": "Do we have the fully executed agreement now? Best, Aidan Schechter AIDAN SCHECHTER P: +1 310.467.6229 | E: AIDAN@1916MGMT.COM"
                },
                {
                  "ThreadId": "198f7c2062f45c15",
                  "EmailId": "198f7c2062f45c15",
                  "MessageId": "<mexcq05s.40f00814-f90d-4dbd-a316-e07f8a4850d5@we.are.superhuman.com>",
                  "References": [
                    "<mctwrly9.f2de59ce-e90a-4dec-b9a7-4b2a8e494e80@we.are.superhuman.com>",
                    "<md57649s.e7584ac4-8d88-47eb-9aed-84da5bfa0117@we.are.superhuman.com>",
                    "<AS2PR02MB10388D120F9DA3981A0A70DA98456A@AS2PR02MB10388.eurprd02.prod.outlook.com>",
                    "<mein0009.2a2b9d4a-1da0-478a-b8bd-8c8b263d1241@we.are.superhuman.com>",
                    "<GV4PR02MB113998C2295A8CAB2B8D4343F8430A@GV4PR02MB11399.eurprd02.prod.outlook.com>",
                    "<GV4PR02MB113996185794A1D0742D521478430A@GV4PR02MB11399.eurprd02.prod.outlook.com>"
                  ],
                  "Subject": "Fwd: RE: RE: Hurri Haran Invoice // \"Stingy\"",
                  "From": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "to": [
                    {
                      "address": "asst@patchbay.xyz",
                      "name": ""
                    }
                  ],
                  "cc": [],
                  "date": "2025-08-29T21:35:42.000Z",
                  "emailText": "Do we have the fully executed agreement now? Best, Aidan Schechter AIDAN SCHECHTER P: +1 310.467.6229 | E: AIDAN@1916MGMT.COM"
                },
                {
                  "Subject": "RE: RE: Hurri Haran Invoice // \"Stingy\"",
                  "From": [
                    {
                      "address": "sam.bradford@sonymusic.com",
                      "name": "Samuel Bradford"
                    }
                  ],
                  "to": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "cc": [],
                  "date": "2025-08-19T08:10:00-07:00",
                  "emailText": "Apologies, I just reviewed the invoice and see you have already included the PO. Once we have the fully executed agmt we can pay this. Thx",
                  "EmailId": "198f7c2062f45c15",
                  "MessageId": "<mexcq05s.40f00814-f90d-4dbd-a316-e07f8a4850d5@we.are.superhuman.com>",
                  "References": [
                    "<mctwrly9.f2de59ce-e90a-4dec-b9a7-4b2a8e494e80@we.are.superhuman.com>",
                    "<md57649s.e7584ac4-8d88-47eb-9aed-84da5bfa0117@we.are.superhuman.com>",
                    "<AS2PR02MB10388D120F9DA3981A0A70DA98456A@AS2PR02MB10388.eurprd02.prod.outlook.com>",
                    "<mein0009.2a2b9d4a-1da0-478a-b8bd-8c8b263d1241@we.are.superhuman.com>",
                    "<GV4PR02MB113998C2295A8CAB2B8D4343F8430A@GV4PR02MB11399.eurprd02.prod.outlook.com>",
                    "<GV4PR02MB113996185794A1D0742D521478430A@GV4PR02MB11399.eurprd02.prod.outlook.com>"
                  ]
                },
                {
                  "Subject": "",
                  "From": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "to": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "cc": [],
                  "date": "2025-08-19T08:10:00-07:00",
                  "emailText": "Do we have the fully executed agreement now? Best,\nAidan Schechter\nAIDAN SCHECHTER\nP: +1 310.467.6229 | E: AIDAN@1916MGMT.COM\n",
                  "EmailId": "198f7c2062f45c15",
                  "MessageId": "<mexcq05s.40f00814-f90d-4dbd-a316-e07f8a4850d5@we.are.superhuman.com>",
                  "References": [
                    "<mctwrly9.f2de59ce-e90a-4dec-b9a7-4b2a8e494e80@we.are.superhuman.com>",
                    "<md57649s.e7584ac4-8d88-47eb-9aed-84da5bfa0117@we.are.superhuman.com>",
                    "<AS2PR02MB10388D120F9DA3981A0A70DA98456A@AS2PR02MB10388.eurprd02.prod.outlook.com>",
                    "<mein0009.2a2b9d4a-1da0-478a-b8bd-8c8b263d1241@we.are.superhuman.com>",
                    "<GV4PR02MB113998C2295A8CAB2B8D4343F8430A@GV4PR02MB11399.eurprd02.prod.outlook.com>",
                    "<GV4PR02MB113996185794A1D0742D521478430A@GV4PR02MB11399.eurprd02.prod.outlook.com>"
                  ]
                },
                {
                  "Subject": "RE: RE: Hurri Haran Invoice // \"Stingy\"",
                  "From": [
                    {
                      "address": "sam.bradford@sonymusic.com",
                      "name": "Bradford, Samuel, Sony Music"
                    }
                  ],
                  "to": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "cc": [],
                  "date": "2025-08-19T11:06:00Z",
                  "emailText": "Hi Aidan- I’m afraid we cannot release full payment without a fully executed agreement. That said I will circle back with a PO number that can be added to the invoice and we’ll be ready to go as soon as we have the fully executed copy. Thx!",
                  "EmailId": "198f7c2062f45c15",
                  "MessageId": "<mexcq05s.40f00814-f90d-4dbd-a316-e07f8a4850d5@we.are.superhuman.com>",
                  "References": [
                    "<mctwrly9.f2de59ce-e90a-4dec-b9a7-4b2a8e494e80@we.are.superhuman.com>",
                    "<md57649s.e7584ac4-8d88-47eb-9aed-84da5bfa0117@we.are.superhuman.com>",
                    "<AS2PR02MB10388D120F9DA3981A0A70DA98456A@AS2PR02MB10388.eurprd02.prod.outlook.com>",
                    "<mein0009.2a2b9d4a-1da0-478a-b8bd-8c8b263d1241@we.are.superhuman.com>",
                    "<GV4PR02MB113998C2295A8CAB2B8D4343F8430A@GV4PR02MB11399.eurprd02.prod.outlook.com>",
                    "<GV4PR02MB113996185794A1D0742D521478430A@GV4PR02MB11399.eurprd02.prod.outlook.com>"
                  ]
                },
                {
                  "Subject": "Fwd: RE: Hurri Haran Invoice // \"Stingy\"",
                  "From": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "to": [
                    {
                      "address": "sam.bradford@sonymusic.com",
                      "name": "Bradford, Samuel, Sony Music"
                    }
                  ],
                  "cc": [],
                  "date": "2025-08-19T10:32:00Z",
                  "emailText": "Hi, Thanks for all this. Attached, see the LOD. I just requested the artist team to ask you to release payment without this being fully executed as I'm still waiting on them for a fully executed copy from the artist. Best, Aidan Schechter\n\nAIDAN SCHECHTER\nP: +1 310.467.6229 | E: AIDAN@1916MGMT.COM\n\n---------- Forwarded message ----------",
                  "EmailId": "198f7c2062f45c15",
                  "MessageId": "<mexcq05s.40f00814-f90d-4dbd-a316-e07f8a4850d5@we.are.superhuman.com>",
                  "References": [
                    "<mctwrly9.f2de59ce-e90a-4dec-b9a7-4b2a8e494e80@we.are.superhuman.com>",
                    "<md57649s.e7584ac4-8d88-47eb-9aed-84da5bfa0117@we.are.superhuman.com>",
                    "<AS2PR02MB10388D120F9DA3981A0A70DA98456A@AS2PR02MB10388.eurprd02.prod.outlook.com>",
                    "<mein0009.2a2b9d4a-1da0-478a-b8bd-8c8b263d1241@we.are.superhuman.com>",
                    "<GV4PR02MB113998C2295A8CAB2B8D4343F8430A@GV4PR02MB11399.eurprd02.prod.outlook.com>",
                    "<GV4PR02MB113996185794A1D0742D521478430A@GV4PR02MB11399.eurprd02.prod.outlook.com>"
                  ]
                },
                {
                  "Subject": "RE: Hurri Haran Invoice // \"Stingy\"",
                  "From": [
                    {
                      "address": "sam.bradford@sonymusic.com",
                      "name": "Bradford, Samuel, Sony Music"
                    }
                  ],
                  "to": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "cc": [],
                  "date": "2025-07-16T16:01:00-04:00",
                  "emailText": "Hi Aidan- It looks like there a few outstanding pieces here: * The attached agreement is only partially executed. We’ll need the fully executed agreement before we can proceed with payment.\n* The address in the agreement does not match what we have in our system.\n* The agreement has an address of 4234 Lockwood Avenue, #2 Los Angeles, CA\n* The invoice and our system has an address of 11689 Margate Street, North Hollywood, CA 91601, USA\n* Can you please advise which is correct? If the former we’ll need to update our system, if the latter we'll need an updated LOD directing payment to that address. We will also need an updated invoice that includes the below info: Invoice Requirements -Remit Address -Bill to Address Sony Music Entertainment 25 Madison Ave New York, NY 10010 ATTN: Sam Bradford -Date -Invoice # - *PO #* *US13668200* -Amount due Please let me know if you have any questions. Thanks!",
                  "EmailId": "198f7c2062f45c15",
                  "MessageId": "<mexcq05s.40f00814-f90d-4dbd-a316-e07f8a4850d5@we.are.superhuman.com>",
                  "References": [
                    "<mctwrly9.f2de59ce-e90a-4dec-b9a7-4b2a8e494e80@we.are.superhuman.com>",
                    "<md57649s.e7584ac4-8d88-47eb-9aed-84da5bfa0117@we.are.superhuman.com>",
                    "<AS2PR02MB10388D120F9DA3981A0A70DA98456A@AS2PR02MB10388.eurprd02.prod.outlook.com>",
                    "<mein0009.2a2b9d4a-1da0-478a-b8bd-8c8b263d1241@we.are.superhuman.com>",
                    "<GV4PR02MB113998C2295A8CAB2B8D4343F8430A@GV4PR02MB11399.eurprd02.prod.outlook.com>",
                    "<GV4PR02MB113996185794A1D0742D521478430A@GV4PR02MB11399.eurprd02.prod.outlook.com>"
                  ]
                },
                {
                  "Subject": "Re: Hurri Haran Invoice // \"Stingy\"",
                  "From": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "to": [
                    {
                      "address": "sam.bradford@sonymusic.com",
                      "name": "Bradford, Samuel, Sony Music"
                    }
                  ],
                  "cc": [],
                  "date": "2025-07-15T20:03:00-04:00",
                  "emailText": "Plz confirm receipt thanks! Best, Aidan Schechter *AIDAN SCHECHTER* P: +1 310.467.6229 | E: AIDAN@ 1916MGMT. COM",
                  "EmailId": "198f7c2062f45c15",
                  "MessageId": "<mexcq05s.40f00814-f90d-4dbd-a316-e07f8a4850d5@we.are.superhuman.com>",
                  "References": [
                    "<mctwrly9.f2de59ce-e90a-4dec-b9a7-4b2a8e494e80@we.are.superhuman.com>",
                    "<md57649s.e7584ac4-8d88-47eb-9aed-84da5bfa0117@we.are.superhuman.com>",
                    "<AS2PR02MB10388D120F9DA3981A0A70DA98456A@AS2PR02MB10388.eurprd02.prod.outlook.com>",
                    "<mein0009.2a2b9d4a-1da0-478a-b8bd-8c8b263d1241@we.are.superhuman.com>",
                    "<GV4PR02MB113998C2295A8CAB2B8D4343F8430A@GV4PR02MB11399.eurprd02.prod.outlook.com>",
                    "<GV4PR02MB113996185794A1D0742D521478430A@GV4PR02MB11399.eurprd02.prod.outlook.com>"
                  ]
                },
                {
                  "Subject": "Re: Hurri Haran Invoice // \"Stingy\"",
                  "From": [
                    {
                      "address": "aidan@1916mgmt.com",
                      "name": "Aidan Schechter"
                    }
                  ],
                  "to": [
                    {
                      "address": "sam.bradford@sonymusic.com",
                      "name": "Bradford, Samuel, Sony Music"
                    }
                  ],
                  "cc": [],
                  "date": "2025-07-07T19:27:00-04:00",
                  "emailText": "Hey Sam, Realized this one didn't get sent to your from our side as we updated vendor info. See attached and let me know when paid out thanks! Best, Aidan Schechter *AIDAN SCHECHTER* P: +1 310.467.6229 | E: AIDAN@ 1916MGMT. COM",
                  "EmailId": "198f7c2062f45c15",
                  "MessageId": "<mexcq05s.40f00814-f90d-4dbd-a316-e07f8a4850d5@we.are.superhuman.com>",
                  "References": [
                    "<mctwrly9.f2de59ce-e90a-4dec-b9a7-4b2a8e494e80@we.are.superhuman.com>",
                    "<md57649s.e7584ac4-8d88-47eb-9aed-84da5bfa0117@we.are.superhuman.com>",
                    "<AS2PR02MB10388D120F9DA3981A0A70DA98456A@AS2PR02MB10388.eurprd02.prod.outlook.com>",
                    "<mein0009.2a2b9d4a-1da0-478a-b8bd-8c8b263d1241@we.are.superhuman.com>",
                    "<GV4PR02MB113998C2295A8CAB2B8D4343F8430A@GV4PR02MB11399.eurprd02.prod.outlook.com>",
                    "<GV4PR02MB113996185794A1D0742D521478430A@GV4PR02MB11399.eurprd02.prod.outlook.com>"
                  ]
                }
              ],
              "Others": [
                {
                  "name": "Samuel Bradford",
                  "address": "sam.bradford@sonymusic.com"
                }
              ],
              "Managers": [
                {
                  "name": "Aidan Schechter",
                  "address": "aidan@1916mgmt.com",
                  "user_id": "b07af3f8-c51e-42df-b5c7-6b5248a5ee5e",
                  "person_number": "beeb7d89-c123-4bf1-90a6-f4a279a0164a",
                  "Role": "Manager",
                  "Clients": []
                }
              ],
              "sessionStatus": true,
              "Label": "CRUD-ASSISTANT"
            },
            "last_email": "It's created already I think Best, Aidan Schechter AIDAN SCHECHTER P: +1 310.467.6229 | E: AIDAN@1916MGMT.COM",
            "Manager": {
              "name": "Aidan Schechter",
              "address": "aidan@1916mgmt.com",
              "user_id": "b07af3f8-c51e-42df-b5c7-6b5248a5ee5e",
              "Clients": []
            }
          }
        }
      }
    ]
  },
  "repo_name": "hub-n8n",
  "repo_owner": "ck-bit",
  "repo_path": "",
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-05-15T17:50:30.024Z",
      "updatedAt": "2025-05-15T17:50:30.024Z",
      "id": "lqzFxyosGtACqbc3",
      "name": "Abid"
    },
    {
      "createdAt": "2025-07-17T04:49:58.248Z",
      "updatedAt": "2025-07-17T04:49:58.248Z",
      "id": "lsVrWvDOcUhldARt",
      "name": "in-devop"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-09-25T03:39:48.255Z",
  "versionId": "cc53ab60-14b6-49a5-91f7-ea0a5a9eafb1"
}